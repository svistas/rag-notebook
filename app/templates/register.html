{% extends "base.html" %}
{% block content %}
<div class="max-w-md mx-auto bg-white border border-slate-200 rounded-xl p-6 space-y-4">
  <h1 class="text-xl font-semibold">Register</h1>
  <p class="text-sm text-slate-600">Create an account to keep your documents private.</p>

  <form id="register-form" class="space-y-3">
    <div class="space-y-1">
      <label class="text-sm">Email</label>
      <input id="email" type="email" class="w-full border border-slate-300 rounded px-3 py-2" required />
    </div>
    <div class="space-y-1">
      <label class="text-sm">Password</label>
      <input id="password" type="password" class="w-full border border-slate-300 rounded px-3 py-2" required />
      <p class="text-xs text-slate-500">Minimum 8 characters.</p>
    </div>
    <button type="submit" class="w-full px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Create account</button>
  </form>

  <p id="status" class="text-sm text-rose-700"></p>
  <p class="text-sm text-slate-600">Already have an account? <a class="text-blue-700 hover:underline" href="/login">Log in</a></p>
</div>

<script>
  const form = document.getElementById("register-form");
  const statusEl = document.getElementById("status");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    statusEl.textContent = "";
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    const body = new URLSearchParams();
    body.set("email", email);
    body.set("password", password);

    const resp = await fetch("/auth/register", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body,
    });
    const payload = await resp.json().catch(() => ({}));
    if (!resp.ok) {
      statusEl.textContent = payload.detail || "Registration failed.";
      return;
    }
    window.location.href = "/";
  });
</script>
{% endblock %}

